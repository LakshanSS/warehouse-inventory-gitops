apiVersion: openchoreo.dev/v1alpha1
kind: ComponentRelease
metadata:
  name: inventory-dashboard-gitops-9dec2481
  namespace: default
spec:
  componentProfile:
    parameters:
      port: 3000
  componentType:
    resources:
    - id: deployment
      template:
        apiVersion: apps/v1
        kind: Deployment
        metadata:
          labels: ${metadata.labels}
          name: ${metadata.name}
          namespace: ${metadata.namespace}
        spec:
          replicas: ${parameters.replicas}
          selector:
            matchLabels: ${metadata.podSelectors}
          template:
            metadata:
              labels: ${metadata.podSelectors}
            spec:
              containers:
              - image: ${workload.containers["main"].image}
                imagePullPolicy: ${parameters.imagePullPolicy}
                name: main
                ports:
                - containerPort: ${parameters.port}
                  name: http
                  protocol: TCP
                resources:
                  limits:
                    cpu: ${envOverrides.resources.limits.cpu}
                    memory: ${envOverrides.resources.limits.memory}
                  requests:
                    cpu: ${envOverrides.resources.requests.cpu}
                    memory: ${envOverrides.resources.requests.memory}
    - id: service
      template:
        apiVersion: v1
        kind: Service
        metadata:
          labels: ${metadata.labels}
          name: ${metadata.componentName}
          namespace: ${metadata.namespace}
        spec:
          ports:
          - name: http
            port: 80
            protocol: TCP
            targetPort: ${parameters.port}
          selector: ${metadata.podSelectors}
          type: ClusterIP
    - id: httproute
      template:
        apiVersion: gateway.networking.k8s.io/v1
        kind: HTTPRoute
        metadata:
          labels: ${metadata.labels}
          name: ${metadata.name}
          namespace: ${metadata.namespace}
        spec:
          hostnames:
          - ${metadata.componentName}-${metadata.environmentName}.${dataplane.publicVirtualHost}
          parentRefs:
          - name: gateway-default
            namespace: openchoreo-data-plane
          rules:
          - backendRefs:
            - name: ${metadata.componentName}
              port: 80
    schema:
      envOverrides:
        resources:
          $default: {}
          limits:
            $default: {}
            cpu: string | default=500m
            memory: string | default=512Mi
          requests:
            $default: {}
            cpu: string | default=100m
            memory: string | default=256Mi
      parameters:
        imagePullPolicy: string | default=IfNotPresent
        port: integer | default=3000
        replicas: integer | default=1
    workloadType: deployment
  owner:
    componentName: inventory-dashboard-gitops
    projectName: default
  workload:
    containers:
      main:
        image: host.k3d.internal:10082/default-inventory-dashboard-gitops-image:v1-9dec2481
